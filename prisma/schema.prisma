// Minimal Prisma Schema for PropertyAnalyzer
// Start with this, then add features as needed

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// ============================================
// CORE MODELS (Start Here)
// ============================================

// User - Synced with Clerk
model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  clerkId   String   @unique
  
  // Basic Info
  email     String   @unique
  firstName String?
  lastName  String?
  imageUrl  String?
  
  // Subscription & Tiers
  subscriptionStatus String   @default("trial")  // "free", "trial", "premium", "enterprise"
  subscriptionTier   String?  // For special tiers: "discount_7day", "early_bird", etc.
  
  // Trial Management
  trialEndsAt        DateTime? // 72 hours from signup
  hasUsedTrial       Boolean  @default(false) // Prevent multiple trials
  
  // Premium Subscription
  subscriptionEndsAt DateTime? // For recurring subscriptions
  stripeCustomerId   String?   // For Stripe integration (future)
  stripeSubscriptionId String? // For Stripe integration (future)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  properties Property[]
  analyses   Analysis[]

  @@map("users")
}

// Property - Store property data
model Property {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Basic Info
  name    String
  address String?
  city    String?
  state   String?
  zipCode String?
  
  // Property Details
  units          Int?
  purchasePrice  Float?
  
  // Income
  monthlyRent    Float?
  otherIncome    Float?
  
  // Expenses
  propertyTax    Float?
  insurance      Float?
  maintenance    Float?
  
  // Images (Cloudinary URLs)
  images      String[]
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  analyses Analysis[]

  @@map("properties")
}

// Analysis - Store property analyses
model Analysis {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     String   @db.ObjectId
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  propertyId String   @db.ObjectId
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  // Analysis Info
  name String
  
  // Store all analysis data as JSON
  data Json
  
  // Key metrics (for quick filtering)
  capRate   Float?
  cashFlow  Float?
  roi       Float?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("analyses")
}
